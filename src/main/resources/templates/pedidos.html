<html layout:decorate="_layout">
    <head>
        <title>Gestión de Pedidos</title>
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
    </head>
    <body>
        <div layout:fragment="content" class="container mt-4" id="app">
            <div class="d-flex justify-content-between align-items-center mb-4">
                <h2>Gestión de pedidos</h2>
                <a href="/nuevospedidos" class="btn btn-success">Agregar orden</a>
            </div>
            <p class="text-end">
                <button><img src="../filtro.png" style="width: 20px"> Filtro</button>
            </p>
            <table class="table table-striped">
                <thead class="table-light">
                    <tr>
                        <th>Id</th>
                        <th>N° de mesa</th>
                        <th>Comensal</th>
                        <th>Mozo</th>
                        <th>N° de personas</th>
                        <th>Costo</th>
                        <th>Fecha</th>
                        <th>Hora</th>
                        <th>Est. Entrega</th>
                        <th>Est. Pago</th>
                        <th class="text-center">Acción</th>
                    </tr>
                </thead>
                <tbody>
                    <tr v-for="item in pedidos" :key="item.id">
                        <td>{{ item.id }}</td>
                        <td>{{ item.nPersona || 'N/A' }}</td>
                        <td>S/ {{ item.costoFinal?.toFixed(2) }}</td>
                        <td>{{ item.fechaCreacion }}</td>
                        <td>{{ item.horaEntrega }}:00</td>
                        <td>{{ item.estadoEntrega }}</td>
                        <td>{{ item.estadoPago }}</td>
                        <td class="text-center">
                            <button class="btn btn-sm btn-primary me-1" @click="irDetalle(item.id)">Ver detalle</button>
                            <button class="btn btn-sm btn-warning" @click="editarEstado(item.id)">Editar estado</button>
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>

        <script layout:fragment="script">
            new Vue({
                el: '#app',
                data: {
                    pedidos: []
                },
                methods: {
                    cargarPedidos() {
                        this.$http.get('/api/pedidos')
                                .then(res => {
                                    this.pedidos = res.data;
                                })
                                .catch(err => console.error('Error al cargar pedidos', err));
                    },
                    irDetalle(id) {
                        window.location.href = `/pedidos/detalle/${id}`;
                    },
                    editarEstado(id) {
                        window.location.href = `/pedidos/editar/${id}`;
                    }
                },
                mounted() {
                    this.cargarPedidos();
                }
            });
        </script>
    </body>
</html>
